Transactions
=

트랜잭션은 유용한 도구이지만, 몽고의 유연함을 살리기 위해서는 적절한 스키마 설계 등을 통해 트랜잭션을 쓰지 않고도 문제를 풀 수 있는 방법을 우선 고려하는 것이 좋다.

1. core API: start_transaction, commit_transaction와 같이 RDB와 유사한 방식의 트랜잭션. 명시적이 제어가 필요하며, 에러 핸들링과 재시도를 제공하지는 않는다.
2. callback API: core와 비교했을 때, 높은 수준으로 래핑되어 사용성이 편리하다. 

Tuning Transaction Limits for Your Application
-
**Timing and Oplog Size Limits**
몽고의 트랜잭션을 제한하는 요소는 크게 두 가지이다.
첫번째는 트랜잭션이 얼마나 오래 락을 기다려주고, 돌도록 허용할 것인가를 제어하는 타이밍과 관련이 있고, 두번째는 몽고의 oplog entry와 entry의 사이즈에 대한 것이다.

몽고의 기본 런타임 시간제한은 1분 미만이다. 하지만 몽고 인스턴스 레벨에서 조작이 가능하다.
만약 sharded clusters의 경우라면 모든 레플리카 셋에 수정이 이루어져야 한다.
시간이 지나면 트랜잭션이 취소되고 클린 업 과정이 이루어지며, 클린 업은 min(시간제한/2, 60초)이다.

락 대기 시간의 경우는 기본값이 5ms이다.
이 시간안에 락을 얻지 못하면 어보트된다.
세팅은 0, -1, 기타 양수로 수정할 수 있는데, 0의 경우 즉시 락을 얻지 못한다면 어보트, -1이라면 대기 가능시간을 맥시멈으로 세팅함을 의미한다.

Oplog 크기 제한은  BSON document의 크기제한인 16MB에 한계가 있다.
