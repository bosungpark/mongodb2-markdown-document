Special Index and Collection Types
=

Indexes for Full Text Search
-
text 인덱스는 full-text search를 지원한다.
단 text index는 MongoDB Atlas의 Full-Text Search Indexes와는 다르다.

문자열을 쿼리할 때, 정규표현식을 사용하는 것도 하나의 대안이 될 수 있지만, 대상이 크면 속도는 느려진다.

text index는 쿼리의 속도와 human language의 특성을 고려한 조회를 지원한다. 만약 어떤 필드에 적용해야할 지 모를 때에는 {"$**" : "찾을 단어"}와 같은 방식으로도 활용이 가능하다. 또 필드 간의 가중치를 주는 것도 가능하다. 개인적으로는 nlp와 유사한 면이 있다고 생각했다. 성능만 문제가 되지 않는다면 이래저래 써먹을 구석은 있을 것 같다.

단, 앞서 말한 특성을 충족시키기 위해 인덱스 생성에 추가적인 비용(토큰화, 어간 추출 등등, 일반적으로 인덱스 중 비용이 매우 큰 편이다)이 든다. 따라서 데이터 삽입, 마이그레이션 등에 속도가 상대적으로 많이 소요되므로, 득실을 잘 따져서 사용해야 한다.

Capped Collections
-
몽고에서 컬렉션은 일반적으로 동적으로 사이즈가 할당되며, 필요시 자동으로 알맞은 사이즈가 배치된다. 

이와 달리 Capped Collections라고 불리는 특수한 컬렉션은 고정된 사이즈를 가지고 생성된다. Capped Collections은 반드시 사전에 직접 생성해주어야하며(혹은 존재하는 컬렉션을 전환시키던가, 사용자의 액션없이 자동으로 Capped인 컬렉션이 생성되지는 않는다), 원형 큐처럼 동작한다. 만약 사이즈가 다 찬다면, 가장 오래된 데이터 부터 삭제된다.

Capped Collections에서는 특정 연산은 제한된다. 도큐먼트는 삭제할 수 없다. 또 도큐먼트의 사이즈가 늘어날 수 있는 업데이트 연산은 제한된다. 이와 같이 두 연산을 제한함으로써, 입력된 순으로 데이터가 쌓이고 중간에 삭제로 인해 놀고 있는 공간이 없음을 보장할 수 있다.

Capped collections은 로깅의 목적으로 사용되는 경향이 있다.
Capped collections와 Tailable Cursors의 조합은 cdc에서 사용되는 경향이 있다. Tailable Cursors는 Capped collections에서만 사용할 수 있는데, 이유는 새로 추가되는 도큐먼트의 위치를 예측할 수 있기 때문이다. (회사의 cdc에도 붙이면 재밌을텐데 아쉽다,,)

Storing Files with GridFS
-
GridFS는 큰 binary files을 저장하기 위한 메커니즘이다.
하지만 파일시스템을 직접사용하는 것에 비하면 속도가 느리고, 삭제후 재저장을 하는 방식을 통해서만 수정할 수 있다.

GridFS는 사실 특수 케이스에 사용되는 것으로 MongoDB의 서버 자체는 GridFS와 관련하여 거의 아무것도 하지 않는다. 드라이버가 대부분의 역할을 한다. 
GridFS의 기본적인 컨셉은 큰 파일을 작은 청크로 나누에 각각의 도큐먼트에 저장한다는 접근이다. (몽고는 바이너리를 지원하므로)







